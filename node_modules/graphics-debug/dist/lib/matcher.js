import {
  getSvgFromGraphicsObject
} from "../chunk-LCOO4FCL.js";
import "../chunk-ZGI74PYD.js";

// lib/matcher.ts
import { expect } from "bun:test";
import * as fs from "fs";
import * as path from "path";
import looksSame from "looks-same";
async function toMatchGraphicsSvg(receivedMaybePromise, testPathOriginal, opts = {}) {
  const received = await receivedMaybePromise;
  const testPath = testPathOriginal.replace(/\.test\.tsx?$/, "");
  const snapshotDir = path.join(path.dirname(testPath), "__snapshots__");
  const snapshotName = opts.svgName ? `${opts.svgName}.snap.svg` : `${path.basename(testPath)}.snap.svg`;
  const filePath = path.join(snapshotDir, snapshotName);
  if (!fs.existsSync(snapshotDir)) {
    fs.mkdirSync(snapshotDir, { recursive: true });
  }
  const receivedSvg = getSvgFromGraphicsObject(received, {
    backgroundColor: opts.backgroundColor
  });
  const updateSnapshot = process.argv.includes("--update-snapshots") || process.argv.includes("-u") || Boolean(process.env["BUN_UPDATE_SNAPSHOTS"]);
  if (!fs.existsSync(filePath) || updateSnapshot) {
    console.log("Writing snapshot to", filePath);
    fs.writeFileSync(filePath, receivedSvg);
    return {
      message: () => `Snapshot created at ${filePath}`,
      pass: true
    };
  }
  const existingSnapshot = fs.readFileSync(filePath, "utf-8");
  const result = await looksSame(
    Buffer.from(receivedSvg),
    Buffer.from(existingSnapshot),
    {
      strict: false,
      tolerance: 2
    }
  );
  if (result.equal) {
    return {
      message: () => "Snapshot matches",
      pass: true
    };
  }
  const diffPath = filePath.replace(".snap.svg", ".diff.png");
  await looksSame.createDiff({
    reference: Buffer.from(existingSnapshot),
    current: Buffer.from(receivedSvg),
    diff: diffPath,
    highlightColor: "#ff00ff"
  });
  return {
    message: () => `Snapshot does not match. Diff saved at ${diffPath}`,
    pass: false
  };
}
expect.extend({
  // biome-ignore lint/suspicious/noExplicitAny: bun's types don't expose matcher type
  toMatchGraphicsSvg
});
//# sourceMappingURL=matcher.js.map