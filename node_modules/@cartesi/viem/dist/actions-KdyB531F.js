import{dataAvailabilityAbi as e,erc1155BatchPortalAbi as t,erc1155BatchPortalAddress as n,erc1155SinglePortalAbi as r,erc1155SinglePortalAddress as i,erc20PortalAbi as a,erc20PortalAddress as o,erc721PortalAbi as s,erc721PortalAddress as c,etherPortalAbi as l,etherPortalAddress as u,iApplicationAbi as d,inputBoxAbi as f,inputBoxAddress as p,outputsAbi as m}from"./rollups-Ce1aMIp2.js";import{decodeFunctionData as h,getAbiItem as g,getAddress as _,hexToBigInt as v,hexToNumber as y,numberToHex as b,toFunctionSelector as x}from"viem";import{estimateContractGas as S,readContract as C,writeContract as w}from"viem/actions";import T,{AbortError as E}from"p-retry";const D=(e,t)=>{let{account:n,chain:r=e.chain,application:i,gas:a,maxFeePerGas:o,maxPriorityFeePerGas:s,nonce:c,payload:l}=t,u={account:n,abi:f,address:p,functionName:`addInput`,args:[i,l],gas:a,maxFeePerGas:o,maxPriorityFeePerGas:s,nonce:c,chain:r};return S(e,u)},ee=async(e,t)=>{let{account:n,application:r,chain:i=e.chain,gas:a,maxFeePerGas:o,maxPriorityFeePerGas:s,nonce:c,payload:l}=t,u=typeof a!=`number`&&a!==null?await D(e,t):void 0;return w(e,{account:n,abi:f,address:p,chain:i,functionName:`addInput`,args:[r,l],gas:u,maxFeePerGas:o,maxPriorityFeePerGas:s,nonce:c})},O=(e,r)=>{let{account:i,application:a,baseLayerData:o,chain:s=e.chain,execLayerData:c,gas:l,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f,token:p,tokenIds:m,values:h}=r,g={account:i,abi:t,address:n,functionName:`depositBatchERC1155Token`,args:[p,a,m,h,o,c],gas:l,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f,chain:s};return S(e,g)},k=async(e,r)=>{let{account:i,application:a,baseLayerData:o,chain:s=e.chain,execLayerData:c,gas:l,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f,token:p,tokenIds:m,values:h}=r,g=typeof l!=`number`&&l!==null?await O(e,r):void 0;return w(e,{account:i,abi:t,address:n,chain:s,functionName:`depositBatchERC1155Token`,args:[p,a,m,h,o,c],gas:g,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f})},A=(e,t)=>{let{account:n,amount:r,application:i,chain:s=e.chain,execLayerData:c,gas:l,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f,token:p}=t,m={account:n,abi:a,address:o,functionName:`depositERC20Tokens`,args:[p,i,r,c],gas:l,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f,chain:s};return S(e,m)},j=async(e,t)=>{let{account:n,amount:r,application:i,chain:s=e.chain,execLayerData:c,gas:l,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f,token:p}=t,m=typeof l!=`number`&&l!==null?await A(e,t):void 0;return w(e,{account:n,abi:a,address:o,chain:s,functionName:`depositERC20Tokens`,args:[p,i,r,c],gas:m,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f})},M=(e,t)=>{let{account:n,application:r,baseLayerData:i,chain:a=e.chain,execLayerData:o,gas:l,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f,token:p,tokenId:m}=t,h={account:n,abi:s,address:c,functionName:`depositERC721Token`,args:[p,r,m,i,o],gas:l,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f,chain:a};return S(e,h)},N=async(e,t)=>{let{account:n,application:r,baseLayerData:i,chain:a=e.chain,execLayerData:o,gas:l,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f,token:p,tokenId:m}=t,h=typeof l!=`number`&&l!==null?await M(e,t):void 0;return w(e,{account:n,abi:s,address:c,chain:a,functionName:`depositERC721Token`,args:[p,r,m,i,o],gas:h,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f})},P=(e,t)=>{let{account:n,chain:r=e.chain,application:i,gas:a,maxFeePerGas:o,maxPriorityFeePerGas:s,nonce:c,execLayerData:d,value:f}=t,p={account:n,abi:l,address:u,functionName:`depositEther`,args:[i,d],gas:a,maxFeePerGas:o,maxPriorityFeePerGas:s,nonce:c,value:f,chain:r};return S(e,p)},F=async(e,t)=>{let{account:n,application:r,chain:i=e.chain,execLayerData:a,gas:o,maxFeePerGas:s,maxPriorityFeePerGas:c,nonce:d,value:f}=t,p=typeof o!=`number`&&o!==null?await P(e,t):void 0;return w(e,{account:n,abi:l,address:u,chain:i,functionName:`depositEther`,args:[r,a],gas:p,maxFeePerGas:s,maxPriorityFeePerGas:c,nonce:d,value:f})},I=(e,t)=>{let{account:n,application:a,baseLayerData:o,chain:s=e.chain,execLayerData:c,gas:l,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f,token:p,tokenId:m,value:h}=t,g={account:n,abi:r,address:i,functionName:`depositSingleERC1155Token`,args:[p,a,m,h,o,c],gas:l,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f,chain:s};return S(e,g)},L=async(e,t)=>{let{account:n,application:a,baseLayerData:o,chain:s=e.chain,execLayerData:c,gas:l,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f,token:p,tokenId:m,value:h}=t,g=typeof l!=`number`&&l!==null?await I(e,t):void 0;return w(e,{account:n,abi:r,address:i,chain:s,functionName:`depositSingleERC1155Token`,args:[p,a,m,h,o,c],gas:g,maxFeePerGas:u,maxPriorityFeePerGas:d,nonce:f})},R=e=>{let{index:t,outputHashesSiblings:n,rawData:r}=e;if(!n)throw Error(`Output has no proof`);return[r,{outputIndex:t,outputHashesSiblings:n}]},z=(e,t)=>{let{account:n,chain:r=e.chain,application:i,gas:a,maxFeePerGas:o,maxPriorityFeePerGas:s,nonce:c,output:l}=t,u=R(l),f={account:n,abi:d,address:i,functionName:`executeOutput`,args:u,gas:a,maxFeePerGas:o,maxPriorityFeePerGas:s,nonce:c,chain:r};return S(e,f)},B=async(e,t)=>{let{account:n,application:r,chain:i=e.chain,gas:a,maxFeePerGas:o,maxPriorityFeePerGas:s,nonce:c,output:l}=t,u=typeof a!=`number`&&a!==null?await z(e,t):void 0,f=R(l);return w(e,{account:n,abi:d,address:r,chain:i,functionName:`executeOutput`,args:f,gas:u,maxFeePerGas:o,maxPriorityFeePerGas:s,nonce:c})},V=e=>({limit:e.limit,offset:e.offset,totalCount:e.total_count}),H=t=>{let{functionName:n,args:r}=h({abi:e,data:t});switch(n){case`InputBox`:{let[e]=r;return{type:n,inputBoxAddress:e}}case`InputBoxAndEspresso`:{let[e,t,i]=r;return{type:n,inputBoxAddress:_(e),fromBlock:t,namespaceId:i}}}},U=e=>({name:e.name,applicationAddress:_(e.iapplication_address),consensusAddress:_(e.iconsensus_address),inputBoxAddress:_(e.iinputbox_address),templateHash:e.template_hash,epochLength:v(e.epoch_length),dataAvailability:H(e.data_availability),state:e.state,reason:e.reason,inputBoxBlock:v(e.iinputbox_block),lastInputCheckBlock:v(e.last_input_check_block),lastOutputCheckBlock:v(e.last_output_check_block),processedInputs:v(e.processed_inputs),createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),executionParameters:{snapshotPolicy:e.execution_parameters.snapshot_policy,advanceIncCycles:v(e.execution_parameters.advance_inc_cycles),advanceMaxCycles:v(e.execution_parameters.advance_max_cycles),inspectIncCycles:v(e.execution_parameters.inspect_inc_cycles),inspectMaxCycles:v(e.execution_parameters.inspect_max_cycles),advanceIncDeadline:v(e.execution_parameters.advance_inc_deadline),advanceMaxDeadline:v(e.execution_parameters.advance_max_deadline),inspectIncDeadline:v(e.execution_parameters.inspect_inc_deadline),inspectMaxDeadline:v(e.execution_parameters.inspect_max_deadline),loadDeadline:v(e.execution_parameters.load_deadline),storeDeadline:v(e.execution_parameters.store_deadline),fastDeadline:v(e.execution_parameters.fast_deadline),maxConcurrentInspects:e.execution_parameters.max_concurrent_inspects,createdAt:new Date(e.execution_parameters.created_at),updatedAt:new Date(e.execution_parameters.updated_at)}}),W=e=>({index:v(e.index),firstBlock:v(e.first_block),lastBlock:v(e.last_block),claimHash:e.claim_hash,claimTransactionHash:e.claim_transaction_hash,status:e.status,virtualIndex:v(e.virtual_index),createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}),G=e=>({epochIndex:v(e.epoch_index),index:v(e.index),blockNumber:v(e.block_number),rawData:e.raw_data,decodedData:{chainId:v(e.decoded_data.chain_id),applicationContract:_(e.decoded_data.application_contract),sender:_(e.decoded_data.sender),blockNumber:v(e.decoded_data.block_number),blockTimestamp:v(e.decoded_data.block_timestamp),prevRandao:v(e.decoded_data.prev_randao),index:v(e.decoded_data.index),payload:e.decoded_data.payload},status:e.status,machineHash:e.machine_hash,outputsHash:e.outputs_hash,transactionReference:e.transaction_reference,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}),K=e=>{switch(e.type){case`Notice`:return{type:`Notice`,payload:e.payload};case`Voucher`:return{type:`Voucher`,payload:e.payload,destination:_(e.destination),value:v(e.value)};case`DelegateCallVoucher`:return{type:`DelegateCallVoucher`,payload:e.payload,destination:_(e.destination)}}},q=e=>({epochIndex:v(e.epoch_index),inputIndex:v(e.input_index),index:v(e.index),rawData:e.raw_data,decodedData:K(e.decoded_data),hash:e.hash,outputHashesSiblings:e.output_hashes_siblings,executionTransactionHash:e.execution_transaction_hash,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}),J=e=>({inputIndex:v(e.input_index),index:v(e.index),rawData:e.raw_data,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}),Y=async(e,t)=>{let{data:n}=await e.request({method:`cartesi_getApplication`,params:t});return U(n)},X=async e=>{let{data:t}=await e.request({method:`cartesi_getChainId`,params:[]});return y(t)},Z=async(e,t)=>{let{data:n}=await e.request({method:`cartesi_getEpoch`,params:{application:t.application,epoch_index:b(t.epochIndex)}});return W(n)},Q=async(e,t)=>{let{data:n}=await e.request({method:`cartesi_getInput`,params:{application:t.application,input_index:b(t.inputIndex)}});return G(n)},te=async(e,t)=>{let{data:n}=await e.request({method:`cartesi_getLastAcceptedEpochIndex`,params:t});return v(n)},ne=async e=>{let{data:t}=await e.request({method:`cartesi_getNodeVersion`,params:[]});return t},re=async(e,t)=>{let{data:n}=await e.request({method:`cartesi_getOutput`,params:{application:t.application,output_index:b(t.outputIndex)}});return q(n)},ie=async(e,t)=>{let{processed_inputs:n}=await e.request({method:`cartesi_getProcessedInputCount`,params:t});return v(n)},ae=async(e,t)=>{let{data:n}=await e.request({method:`cartesi_getReport`,params:{application:t.application,report_index:b(t.reportIndex)}});return J(n)},oe=async(e,t)=>{let n=await e.request({method:`cartesi_listApplications`,params:t??{}});return{pagination:V(n.pagination),data:n.data.map(U)}},$=async(e,t)=>{let n=await e.request({method:`cartesi_listEpochs`,params:t});return{data:n.data.map(W),pagination:V(n.pagination)}},se=async(e,t)=>{let n=await e.request({method:`cartesi_listInputs`,params:{application:t.application,epoch_index:t.epochIndex===void 0?void 0:b(t.epochIndex),sender:t.sender,limit:t.limit,offset:t.offset}});return{data:n.data.map(G),pagination:V(n.pagination)}},ce=e=>{switch(e){case`Notice`:return x(g({abi:m,name:`Notice`}));case`Voucher`:return x(g({abi:m,name:`Voucher`}));case`DelegateCallVoucher`:return x(g({abi:m,name:`DelegateCallVoucher`}))}},le=async(e,t)=>{let n=ce(t.outputType),r=await e.request({method:`cartesi_listOutputs`,params:{application:t.application,epoch_index:t.epochIndex===void 0?void 0:b(t.epochIndex),input_index:t.inputIndex===void 0?void 0:b(t.inputIndex),output_type:n,voucher_address:t.voucherAddress,limit:t.limit,offset:t.offset}});return{data:r.data.map(q),pagination:V(r.pagination)}},ue=async(e,t)=>{let n=await e.request({method:`cartesi_listReports`,params:{application:t.application,epoch_index:t.epochIndex===void 0?void 0:b(t.epochIndex),input_index:t.inputIndex===void 0?void 0:b(t.inputIndex),limit:t.limit,offset:t.offset}});return{data:n.data.map(J),pagination:V(n.pagination)}},de=async(e,t)=>{let{application:n,output:r}=t,i=R(r);try{return await C(e,{...t,abi:d,address:n,args:i,functionName:`validateOutput`}),!0}catch{return!1}},fe=async(e,t)=>{let n=t.pollingInterval??e.pollingInterval,r=t.retryCount??10,i=t.timeout,a=t.waitProcessing===void 0?!0:t.waitProcessing,o=t.rejectErrors===void 0?!1:t.rejectErrors,s=await T(async()=>{let{data:n}=await e.request({method:`cartesi_getInput`,params:{application:t.application,input_index:b(t.inputIndex)}});if(a&&n.status===`NONE`)throw Error(`Input is not processed`);if(o&&(n.status===`CYCLE_LIMIT_EXCEEDED`||n.status===`EXCEPTION`||n.status===`MACHINE_HALTED`||n.status===`PAYLOAD_LENGTH_LIMIT_EXCEEDED`||n.status===`REJECTED`||n.status===`TIME_LIMIT_EXCEEDED`||n.status===`OUTPUTS_LIMIT_EXCEEDED`))throw new E(`Input status: ${n.status}`);return n},{retries:r,minTimeout:n,factor:1,maxRetryTime:i});return G(s)};export{ee as addInput,k as depositBatchERC1155Token,j as depositERC20Tokens,N as depositERC721Token,F as depositEther,L as depositSingleERC1155Token,D as estimateAddInputGas,O as estimateDepositBatchERC1155TokenGas,A as estimateDepositERC20TokensGas,M as estimateDepositERC721TokenGas,P as estimateDepositEtherGas,I as estimateDepositSingleERC1155TokenGas,z as estimateExecuteOutputGas,B as executeOutput,Y as getApplication,X as getChainId,Z as getEpoch,Q as getInput,te as getLastAcceptedEpochIndex,ne as getNodeVersion,re as getOutput,ie as getProcessedInputCount,ae as getReport,oe as listApplications,$ as listEpochs,se as listInputs,le as listOutputs,ue as listReports,de as validateOutput,fe as waitForInput};
//# sourceMappingURL=actions-KdyB531F.js.map